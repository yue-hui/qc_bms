(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-839f"],{BlXQ:function(e,t,s){"use strict";s.r(t);var a=s("QbLZ"),i=s.n(a),n=s("GQeE"),r=s.n(n),c=s("FyfS"),l=s.n(c),o=s("gDS+"),u=s.n(o),_=s("MQ60"),d=s.n(_),m=s("YP4+"),f=s("S583"),p=s("Zkmf"),b={name:"SpecialCreateEdit",components:{vuedraggable:d.a},props:{action:{type:Number,default:0},current:{type:Object,default:function(){return{}}}},data:function(){return{visiable_height:"",is_busy:!1,grade_list:m.w,soft_list:[],sendpass_second_url:[],query_soft_name:"",form:{subject_name:"",grade_list:[],subject_banner_url:"",record_id_list:[],subject_details:""},rules:{subject_name:[{required:!0,message:"请输入推荐应用专题名称, 15字以内",trigger:"blur"},{min:1,max:15,message:"文字长度不能超过15个字",trigger:"blur"}],grade_list:[{required:!0,type:"array",message:"至少选择一个年级",trigger:"blur",min:1}],subject_banner_url:[{required:!0,message:"请上传推荐应用专题图片",trigger:"blur"}],record_id_list:[{required:!0,type:"array",message:"至少添加一个应用",trigger:"change",min:1}],subject_details:[{required:!0,message:"专题方案不能为空",trigger:"blur"}]}}},computed:{},watch:{action:{handler:function(e){1===e||0===e?this.clear_data():this.init_props_data();var t=void 0;t=1===e?"创建推荐应用专题":2===e?"编辑推荐应用专题":"",this.title=t},immediate:!0}},mounted:function(){this.visiable_height=document.documentElement.clientHeight+"px"},methods:{query_search_async:function(e,t){var s=this,a={soft_name:e};Object(f.mb)(a).then(function(e){var a=[];0===e.status?a=e.data.map(function(e){var t=e.soft_name;return i()({},e,{value:t})}):s.$message.error(e.message),t(a)})},query_select_handle:function(e){var t=e.record_id;-1===this.form.record_id_list.indexOf(t)&&(this.soft_list.push(e),this.update_record_id_list()),this.query_soft_name=""},update_record_id_list:function(){this.form.record_id_list=this.soft_list.map(function(e){return e.record_id})},dialog_card_action:function(){this.close_dialog()},close_dialog:function(){this.$emit("callback")},on_submit:function(){var e=this;this.$refs.form.validate(function(t){t&&(-1!==[0,1].indexOf(e.action)?e.on_create():e.on_save())})},on_save:function(){var e=this;this.is_busy=!0,Object(f.F)(this.form).then(function(t){0===t.status?(e.$message.success(t.message),e.$emit("callback",!0)):e.$message.error(t.message)}).finally(function(){e.is_busy=!1})},on_create:function(){var e=this;this.is_busy=!0,Object(f.j)(this.form).then(function(t){0===t.status?(e.$message.success(t.message),e.$emit("callback",!0)):e.$message.error(t.message)}).finally(function(){e.is_busy=!1})},change_grade:function(e){},change_device_type:function(e){this.public_form.device_type=e},change_un_pub_device_type:function(e){this.un_public_form.device_type=e},clear_data:function(){this.form={grade_list:[],subject_name:"",subject_banner_url:"",record_id_list:[],subject_details:""}},init_props_data:function(){var e=this,t=this.current.rec_subject_id,s={rec_subject_id:t};Object(f.Fb)(s).then(function(s){if(0===s.status){var a=s.data,i=a.soft_list.map(function(e){return e.record_id});e.form={rec_subject_id:t,subject_name:a.subject_name,grade_list:a.grade_list||[],subject_banner_url:a.subject_banner_url,subject_details:a.subject_details,record_id_list:i},e.sendpass_second_url=[{uid:(new Date).getTime(),name:a.subject_banner_url}],e.soft_list=a.soft_list||[]}else e.clear_data(),e.$message.error(s.message)})},on_editor_change:function(e){e.quill;var t=e.html;e.text;this.form.subject_details=t},push_picture_to_cloud:function(e){var t=this;if(this.sendpass_second_url.length>=1)this.$message.warning("只能上传一张图片");else{var s=e.file;Object(p.a)(s).then(function(a){var i=a.data;if(-1!==[1,-2,"-2"].indexOf(i.status))Object(p.b)(s).then(function(s){var a=s.data;if(0===a.status){var i=a.data.url,n={name:e.file.name,url:i};t.sendpass_second_url.push(n),t.form.subject_banner_url=n.name}else t.$message.error(a.message)});else if(-1===i.status)t.$message.error(i.message);else if(0===i.status){var n=i.data.url,r={name:e.file.name,url:n};t.sendpass_second_url.push(r),t.form.subject_banner_url=r.url,t.$message.success("上传成功")}else t.$message.error(i.message)})}},remove_picture:function(){this.sendpass_second_url=[],this.form.subject_banner_url=""},delete_soft_item:function(e){var t=e.record_id,s=this.soft_list;this.soft_list=s.filter(function(e){return e.record_id!==t}),this.update_record_id_list()},change_soft_list:function(){this.update_record_id_list()}}},g=(s("nl9Z"),s("KHd+")),h=Object(g.a)(b,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"component-card-with-dialog"},[s("div",{staticClass:"component-card",on:{click:function(t){return t.target!==t.currentTarget?null:e.dialog_card_action(t)}}},[s("div",{staticClass:"dialog",style:{"max-height":e.visiable_height}},[s("div",{staticClass:"head-area"},[s("div",{staticClass:"title"},[e._v(e._s(e.title))]),e._v(" "),s("div",{staticClass:"close-icon",on:{click:e.close_dialog}},[s("i",{staticClass:"el-message-box__close el-icon-close"})])]),e._v(" "),s("div",{staticClass:"body-area"},[s("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"120px","label-suffix":":"}},[2===e.action&&"01"===e.form.plan_type?s("el-form-item",{attrs:{label:"套餐ID",prop:"plan_name"}},[s("el-input",{staticClass:"input-disable-with-selected",attrs:{disabled:"",size:"mini"},model:{value:e.form.plan_id,callback:function(t){e.$set(e.form,"plan_id",t)},expression:"form.plan_id"}})],1):e._e(),e._v(" "),s("el-form-item",{attrs:{label:"专题名称",prop:"subject_name"}},[s("el-input",{staticClass:"input-disable-with-selected",attrs:{disabled:2===e.action,size:"mini"},model:{value:e.form.subject_name,callback:function(t){e.$set(e.form,"subject_name",t)},expression:"form.subject_name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"年级选择",prop:"grade_list"}},[s("el-checkbox-group",{on:{change:e.change_grade},model:{value:e.form.grade_list,callback:function(t){e.$set(e.form,"grade_list",t)},expression:"form.grade_list"}},[s("el-row",{attrs:{span:24}},e._l(e.grade_list,function(t,a){return s("el-col",{key:a,attrs:{span:4}},[s("el-checkbox",{key:t.val,attrs:{label:t.val}},[e._v(e._s(t.name))])],1)}),1)],1)],1),e._v(" "),s("el-form-item",{attrs:{label:"专题图片",prop:"subject_banner_url"}},[s("el-upload",{staticClass:"upload-demo",attrs:{"http-request":e.push_picture_to_cloud,"on-remove":e.remove_picture,multiple:!1,limit:1,"file-list":e.sendpass_second_url,action:"","list-type":"picture"}},[s("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1),e._v(" "),s("div",{staticClass:"upload-file-to-server"},[e._v("备注: 只能上传jpg/png文件, 图片尺寸为690x240，且不超过500kb.")])],1),e._v(" "),s("el-form-item",{attrs:{label:"专题文案",prop:"subject_details"}},[s("el-input",{attrs:{rows:5,resize:"none",type:"textarea",placeholder:"请输入专题文案"},model:{value:e.form.subject_details,callback:function(t){e.$set(e.form,"subject_details",t)},expression:"form.subject_details"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"应用添加",prop:"record_id_list"}},[s("el-autocomplete",{staticStyle:{width:"100%"},attrs:{"fetch-suggestions":e.query_search_async,placeholder:"请输入要添加的应用",size:"mini",clearable:""},on:{select:e.query_select_handle},model:{value:e.query_soft_name,callback:function(t){e.query_soft_name=t},expression:"query_soft_name"}}),e._v(" "),s("div",{staticClass:"list-all-soft"},[s("div",{staticClass:"soft-record-row row-header"},[s("div",{staticClass:"column-item column-with-index"},[e._v("序列号")]),e._v(" "),s("div",{staticClass:"column column-item column-with-padding"},[e._v("应用名称")]),e._v(" "),s("div",{staticClass:"column-item column-with-control"},[e._v("操作")])]),e._v(" "),s("vuedraggable",{staticClass:"wrapper",on:{change:e.change_soft_list},model:{value:e.soft_list,callback:function(t){e.soft_list=t},expression:"soft_list"}},[s("transition-group",e._l(e.soft_list,function(t,a){return s("div",{key:t,staticClass:"soft-record-row row-body"},[s("div",{staticClass:"column-item column-with-index"},[e._v(e._s(a+1))]),e._v(" "),s("div",{staticClass:"column column-item column-with-padding"},[e._v(e._s(t.soft_name))]),e._v(" "),s("div",{staticClass:"column-item column-with-control delete-action",on:{click:function(s){return e.delete_soft_item(t)}}},[e._v("删除\n                    ")])])}),0)],1)],1)],1),e._v(" "),s("el-form-item",[s("div",{staticClass:"action-area"},[s("el-button",{attrs:{size:"mini"},on:{click:e.close_dialog}},[e._v("取消")]),e._v(" "),s("gl-button",{attrs:{disabled:e.is_busy,pid:"10023,10013",size:"mini",type:"primary"},on:{click:e.on_submit}},[e._v("确定")])],1)])],1)],1)])])])},[],!1,null,"b58d7dbc",null).exports,v=s("z0WU"),j=s("X4fA"),y={components:{SpecialCreateEdit:h},data:function(){var e=Object(j.a)();return{loading:!1,query_sets:{},packages:m.F,status_list:m.E,action:0,recommend_subject_list:[],page:1,page_size:e,page_sizes:m.T,total:0}},computed:{},mounted:function(){this.fetch_recommend_subject_list()},methods:{get_condition:function(){var e=JSON.parse(u()(this.query_sets)),t={},s=!0,a=!1,i=void 0;try{for(var n,c=l()(r()(e));!(s=(n=c.next()).done);s=!0){var o=n.value;e[o]&&(t[o]=e[o])}}catch(e){a=!0,i=e}finally{try{!s&&c.return&&c.return()}finally{if(a)throw i}}return t},grade_label_list:function(e){return e.map(function(e){return Object(v.g)(e)})},get_condition_with_pagination:function(){var e=this.get_condition();return e.page_no=this.page,e.page_num=this.page_size,e},field_mapper:function(e){var t=this;return e.map(function(e){var s=Object(v.b)(e.create_time,m.o),a=void 0;return a="1"===e.is_listing?"生效中":"0"===e.is_listing?"未生效":"未知",i()({},e,{is_listing_label:a,grade_label_list:t.grade_label_list(e.grade_list),create_time_label:s})})},fetch_recommend_subject_list:function(){var e=this;this.loading=!0;var t=this.get_condition_with_pagination();Object(f.Gb)(t).then(function(t){e.recommend_subject_list=e.field_mapper(t.data),e.total=t.total_count}).finally(function(){e.loading=!1})},query_condition_change:function(){this.page=1,this.page_size=Object(j.a)(),this.query()},query:function(){this.fetch_recommend_subject_list()},table_size_change:function(e){this.page_size=e,Object(j.d)(e),this.fetch_recommend_subject_list()},change_current:function(e){this.page=e,this.fetch_recommend_subject_list()},show_table_button_label:function(e){return"1"===e.is_listing?"下架":"0"===e.is_listing?"上架":"状态异常"},change_shelf_status:function(e){var t=this,s=void 0,a=void 0;"1"===e.is_listing?(s="你确定要下架该推荐应用专题吗?",a="0"):"0"===e.is_listing&&(s="你确定要上架该推荐应用专题吗?",a="1"),this.$confirm(s,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var s={rec_subject_id:e.rec_subject_id,is_listing:a};Object(f.cc)(s).then(function(e){0===e.status?(t.$message.success(e.message),t.fetch_recommend_subject_list()):t.$message.error(e.message)})}).catch(function(){t.$message({type:"info",message:"已取消上下架操作"})})},close_package_dialog:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.action=0,this.current={},e&&this.fetch_recommend_subject_list()},create_package:function(){this.action=1,this.current={}},edit_shelf:function(e){this.action=2,this.current=e},delete_shelf:function(e){var t=this;if("1"!==e.is_listing){var s='推荐应用专题"'+e.subject_name+'"需要下架才可以删除?';this.$confirm(s,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var s={rec_subject_id:e.rec_subject_id};Object(f.K)(s).then(function(e){0===e.status?(t.$message.success(e.message),t.fetch_recommend_subject_list()):t.$message.error(e.message)})}).catch(function(){t.$message({type:"info",message:"已取消删除推荐应用专题的操作"})})}else this.$message.error("该专题已上架，无法删除，请下架后操作!")}}},w=(s("PrSw"),Object(g.a)(y,function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"gelei-content"},[s("div",{staticClass:"header-line"},[s("div",{staticClass:"header-line-left"}),e._v(" "),s("div",{staticClass:"header-line-right"},[s("div",{staticClass:"control-box"},[s("gl-button",{attrs:{pid:"20035",size:"mini",type:"success"},on:{click:e.create_package}},[e._v("创建应用专题")])],1)])]),e._v(" "),s("div",{staticClass:"content-body"},[s("div",{staticClass:"table-content table-block"},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.recommend_subject_list,size:"mini",stripe:""}},[s("el-table-column",{attrs:{align:"center",label:"应用专题名称",prop:"subject_name",width:"200"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"年级",prop:"grade_list",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-row",{staticClass:"table-item",attrs:{gutter:2}},e._l(t.row.grade_label_list,function(t,a){return s("el-col",{key:a,staticClass:"show-list-content",attrs:{span:8}},[s("el-tag",{staticClass:"show-list-item",attrs:{size:"mini"}},[e._v(e._s(t))])],1)}),1)]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"应用数量",prop:"app_count"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"安装次数",prop:"install_count"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"创建时间",prop:"create_time_label"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"状态",prop:"is_listing_label"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"操作",prop:"control"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("gl-button",{staticStyle:{"padding-bottom":"2px","border-bottom":"1px solid"},attrs:{pid:"20080",size:"small",type:"text"},on:{click:function(s){return e.change_shelf_status(t.row)}}},[e._v(e._s(e.show_table_button_label(t.row))+"\n            ")]),e._v(" "),s("gl-button",{staticStyle:{"padding-bottom":"2px","border-bottom":"1px solid"},attrs:{pid:"20079",size:"small",type:"text"},on:{click:function(s){return e.edit_shelf(t.row)}}},[e._v("编辑\n            ")]),e._v(" "),s("gl-button",{staticStyle:{"padding-bottom":"2px","border-bottom":"1px solid"},attrs:{pid:"20100",size:"small",type:"text"},on:{click:function(s){return e.delete_shelf(t.row)}}},[e._v("删除\n            ")])]}}])})],1),e._v(" "),s("el-pagination",{attrs:{"current-page":e.page,"page-size":e.page_size,"page-sizes":e.page_sizes,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"current-change":e.change_current,"size-change":e.table_size_change}})],1)]),e._v(" "),e.action?s("special-create-edit",{attrs:{action:e.action,current:e.current},on:{callback:e.close_package_dialog}}):e._e()],1)},[],!1,null,"ec972c2a",null));t.default=w.exports},PrSw:function(e,t,s){"use strict";var a=s("SNBa");s.n(a).a},SNBa:function(e,t,s){},ZU4k:function(e,t,s){},Zkmf:function(e,t,s){"use strict";s.d(t,"a",function(){return m}),s.d(t,"b",function(){return f});var a,i,n=s("14Xm"),r=s.n(n),c=s("D3Ub"),l=s.n(c),o=s("+bwJ"),u=s("vDqi"),_=s.n(u),d=s("z0WU"),m=(a=l()(r.a.mark(function e(t){var s,a,i,n,c,l;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(d.a)(t);case 2:return s=e.sent,a={hash:s},i={headers:{"Content-Type":"application/json"},baseURL:"/gelei-guard-bms/api"},n="/file/data/secondpass",c=Object(o.a)(a),l=JSON.parse(c),e.next=10,_.a.post(n,l,i);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)}),f=(i=l()(r.a.mark(function e(t){var s,a,i,n,c,l,u,m;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(s=new FormData).append("file",t),e.next=4,Object(d.a)(t);case 4:for(m in a=e.sent,i={hash:a},n={headers:{"Content-Type":"multipart/form-data"},baseURL:"/gelei-guard-bms/api"},c=Object(o.a)(i),l="/file/data/upload",u=JSON.parse(c))s.append(m,u[m]);return e.next=13,_.a.post(l,s,n);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},nl9Z:function(e,t,s){"use strict";var a=s("ZU4k");s.n(a).a}}]);